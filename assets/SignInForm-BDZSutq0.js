import{r as t,u as F,a as z,j as e,L,b as p,I as h,B as A}from"./index-RWvjyKq-.js";import{a as f}from"./index-t--hEgTQ.js";import{S as D,a as P}from"./eye-close-Cn3oZ18V.js";function J({handleForgotPassword:j}){const[l,b]=t.useState(!1),[B,$]=t.useState(!1),[i,w]=t.useState({email:"",password:""}),[r,n]=t.useState({}),[y,o]=t.useState(!1),{isAuthenticated:d,setIsAuthenticated:S,user:v,setUser:N}=F(),[c,E]=t.useState({lat:null,lon:null}),[k,m]=t.useState(!1),x=z(),I=()=>{let s={};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)||(s.email="Enter a valid email address."),/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}/.test(i.password)||(s.password="Password must be at least 8 characters long, include an uppercase, a lowercase, a number, and a special character."),n(s),Object.keys(s).length===0},u=s=>{w({...i,[s.target.name]:s.target.value}),n({...r,[s.target.name]:""})};t.useEffect(()=>{d&&(console.log("redirecting",d),x("/admin"))},[d,x]),t.useEffect(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(s=>{E({lat:s.coords.latitude,lon:s.coords.longitude}),o(!0)},s=>{n(a=>({...a,geolocation:s.message})),o(!1)}):(n(s=>({...s,geolocation:"Geolocation is not supported by this browser."})),o(!1))},[]);const C=async s=>{if(s.preventDefault(),I()){m(!0);try{const a=await f.post("https://digibanana.com/erp/api/login",null,{params:{email:i.email,password:i.password}});if(N({...v,id:a.data.id}),a.data.id){localStorage.setItem("id",JSON.stringify(a.data.id)),S(!0);try{const g=await f.post("https://digibanana.com/digierp/api/location",{latitude:c.lat,longitude:c.lon});console.log("Location Sent Successfully")}catch(g){console.error("Location Sending Failed",g)}}else n({...r,signinError:a.data.message}),console.error("Sign In Failed",a.data.message)}catch(a){console.error("Sign In Failed",a)}finally{m(!1)}}};return e.jsx(e.Fragment,{children:k?e.jsx(L,{}):e.jsx("div",{className:"flex flex-col flex-1",children:e.jsx("div",{className:"flex flex-col justify-center flex-1 w-full max-w-md mx-auto",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-5 sm:mb-8",children:[e.jsx("h1",{className:"mb-2 font-semibold text-gray-800 text-title-sm dark:text-white/90 sm:text-title-md",children:"Sign In"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enter your email and password to sign in!"}),r.signinError&&e.jsx("p",{className:"mt-2 bg-red-100 p-2 rounded-md text-red-800 text-xs",children:r.signinError})]}),e.jsx("div",{children:e.jsx("form",{onSubmit:C,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(p,{children:["Email ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsx(h,{type:"email",name:"email",placeholder:"info@gmail.com",onChange:u}),r.email&&e.jsx("p",{className:"text-red-500 text-xs",children:r.email})]}),e.jsxs("div",{children:[e.jsxs(p,{children:["Password ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:l?"text":"password",name:"password",placeholder:"Enter your password",onChange:u}),e.jsx("span",{onClick:()=>b(!l),className:"absolute z-30 -translate-y-1/2 cursor-pointer right-4 top-1/2",children:l?e.jsx(D,{className:"fill-gray-500 dark:fill-gray-400 size-5"}):e.jsx(P,{className:"fill-gray-500 dark:fill-gray-400 size-5"})})]}),r.password&&e.jsx("p",{className:"text-red-500 text-xs",children:r.password})]}),y&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{type:"button",onClick:j,className:"text-sm text-brand-500 hover:text-brand-600 dark:text-brand-400",children:"Forgot password?"})}),e.jsx(A,{className:"w-full",size:"sm",type:"submit",children:"Sign in"})]})]})})})]})})})})}export{J as default};
